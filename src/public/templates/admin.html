<section class="panel">
  <p class="eyebrow">Admin</p>
  <h2>Circle settings and policy</h2>
  <p>Configure how this node enforces wallet verification, circle alignment, and peer aggregation.</p>
  <div class="callout">
    <p class="muted small">Circle name: {{circleName}}</p>
    <p class="muted small">Policy ID: {{policyId}} v{{policyVersion}}</p>
    <p class="muted small">Posting gate: {{postingGate}}</p>
    <p class="muted small">Ledger entries: {{ledgerEntries}} Â· Peers: {{peersKnown}}</p>
    <p class="muted small">Data: {{dataProfile}}</p>
    <p class="muted small">Extensions: {{extensionsSummary}}</p>
    <p class="muted small">Initialized: {{initialized}}</p>
    <p class="muted small">{{notes}}</p>
    <p class="muted small">{{firstRunNote}}</p>
  </div>
  <p class="muted small">{{flash}}</p>
  <form class="stack" method="post" action="/admin" data-enhance="admin">
    <div class="form-grid">
      <label class="field">
        <span>Circle name</span>
        <input name="circleName" value="{{circleName}}" placeholder="Party Circle" />
      </label>
      <label class="field">
        <span>Policy ID</span>
        <input name="policyId" value="{{policyId}}" placeholder="party-circle-alpha" />
      </label>
    </div>
    <div class="form-grid">
      <label class="field checkbox">
        <input type="checkbox" name="enforceCircle" {{enforceCircleChecked}} />
        <span>Enforce Circle (verification before posting/voting)</span>
      </label>
      <label class="field checkbox">
        <input type="checkbox" name="requireVerification" {{requireVerificationChecked}} />
        <span>Require wallet verification for posting</span>
      </label>
    </div>
    <div class="form-grid">
      <label class="field">
        <span>Admin contact</span>
        <input name="adminContact" value="{{adminContact}}" placeholder="admin@example.org" />
      </label>
      <label class="field">
        <span>Preferred peer (Circle anchor)</span>
        <input name="preferredPeer" value="{{preferredPeer}}" placeholder="https://peer.party" />
      </label>
    </div>
    <div class="form-grid">
      <label class="field">
        <span>Default group election mode</span>
        <select name="defaultElectionMode">
          <option value="priority" {{defaultElectionModePriority}}>Priority</option>
          <option value="vote" {{defaultElectionModeVote}}>Vote</option>
        </select>
      </label>
      <label class="field">
        <span>Default group conflict rule</span>
        <select name="defaultConflictRule">
          <option value="highest_priority" {{defaultConflictHighest}}>Highest priority</option>
          <option value="prompt_user" {{defaultConflictPrompt}}>Prompt user</option>
        </select>
      </label>
    </div>
    <div class="form-grid">
      <label class="field">
        <span>Topic gardener URL (optional)</span>
        <input name="topicGardenerUrl" value="{{topicGardenerUrl}}" placeholder="http://localhost:8070/classify" />
      </label>
      <label class="field">
        <span>Topic anchors (comma separated)</span>
        <input name="topicAnchors" value="{{topicAnchors}}" placeholder="general,governance,economy" />
      </label>
    </div>
    <label class="field">
      <span>Pinned topics (comma separated)</span>
      <input name="topicPinned" value="{{topicPinned}}" placeholder="climate,health,education" />
    </label>
    <p class="muted small">Anchors and pins guide the topic gardener to reconcile provider labels.</p>
    <label class="field">
      <span>Notes</span>
      <textarea name="notes" rows="3" placeholder="Document circle intent or shared policy">{{notes}}</textarea>
    </label>
    <div class="form-grid">
      <label class="field">
        <span>Add peer and aggregate</span>
        <input name="peerJoin" placeholder="https://peer.party" />
      </label>
      <div class="stack">
        <p class="muted small">Add a trusted peer to sync ledger/policies. This will persist to the peer registry.</p>
      </div>
    </div>
    <div class="cta-row">
      <button class="cta" type="submit">Save settings</button>
      <a class="ghost" href="/" data-partial>Back home</a>
    </div>
    <p class="muted small">First installation hint: toggle enforcement + add a peer to align with a Circle. Settings persist to <code>src/data/settings.json</code>.</p>
  </form>
</section>

<section class="panel">
  <p class="eyebrow">Extensions</p>
  <h2>Toggle modules</h2>
  <p class="muted small">Enable/disable extensions at runtime (persists to settings).</p>
  <form class="stack" method="post" action="/extensions" data-enhance="extensions">
    <div class="form-grid">{{extensionsList}}</div>
    <div class="cta-row">
      <button class="cta" type="submit">Apply extensions</button>
    </div>
    <p class="muted small">POSTs to /extensions; reload applies hooks immediately.</p>
  </form>
</section>

<section class="panel">
  <p class="eyebrow">Session overrides</p>
  <h2>Roles and bans</h2>
  <p class="muted small">Update a session role/handle or ban a handle to exercise Circle gates without editing JSON manually.</p>
  <form class="stack" method="post" action="/admin" data-enhance="admin">
    <input type="hidden" name="intent" value="session" />
    <div class="form-grid">
      <label class="field">
        <span>Session ID</span>
        <input name="sessionId" value="{{sessionIdValue}}" placeholder="copy from /health or logs" required />
      </label>
      <label class="field">
        <span>Handle override (optional)</span>
        <input name="sessionHandle" value="{{sessionHandleValue}}" placeholder="citizen-abcd1234" />
      </label>
    </div>
    <div class="form-grid">
      <label class="field">
        <span>Role</span>
        <select name="sessionRole">
          <option value="citizen" {{sessionRoleCitizen}}>citizen</option>
          <option value="delegate" {{sessionRoleDelegate}}>delegate</option>
          <option value="moderator" {{sessionRoleModerator}}>moderator</option>
          <option value="admin" {{sessionRoleAdmin}}>admin</option>
        </select>
      </label>
      <label class="field checkbox">
        <input type="checkbox" name="sessionBanned" {{sessionBannedChecked}} />
        <span>Ban this handle/session</span>
      </label>
    </div>
    <div class="cta-row">
      <button class="cta" type="submit">Update session</button>
      <a class="ghost" href="/health" target="_blank" rel="noreferrer">Open /health to fetch session IDs</a>
    </div>
    <p class="muted small">Changes persist to <code>src/data/sessions.json</code> and are used by Circle gates immediately.</p>
  </form>
</section>
